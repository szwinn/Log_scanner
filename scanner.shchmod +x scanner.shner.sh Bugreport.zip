#!/bin/bash

# Permite ** para subpastas no Termux
shopt -s globstar
shopt -s nullglob

echo "=== SCANNER BY SOUZA ==="
echo

ZIP="$1"

if [ -z "$ZIP" ]; then
  echo "Uso: ./scanner.sh bugreport.zip"
  exit 1
fi

if [ ! -f "$ZIP" ]; then
  echo "Arquivo não encontrado: $ZIP"
  exit 1
fi

rm -rf scan_temp
mkdir scan_temp

unzip -qq "$ZIP" -d scan_temp

echo "Analisando arquivos de log..."
echo

score=0

# Palavras relacionadas a hack
keywords=(
  "xit"
  "painel"
  "mod"
  "cheat"
  "auxilio"
  "auxílio"
  "headtrick"
  "holograma"
  "wallhack"
  "bypass"
)

# Palavras que indicam possível desinstalação
uninstall_keywords=(
  "uninstall"
  "pm uninstall"
  "package removed"
  "removed package"
  "package deleted"
  "delete package"
)

# ===== SCAN PRINCIPAL =====
for file in scan_temp/**/*.txt scan_temp/**/*.log; do
  [ -f "$file" ] || continue

  for key in "${keywords[@]}"; do
    results=$(grep -in "$key" "$file")
    if [ -n "$results" ]; then
      echo "[!] Palavra detectada: \"$key\""
      echo "    Arquivo: $file"
      echo "$results" | while read -r line; do
        echo "    Linha: $line"
      done
      score=$((score+1))
    fi
  done
done

# ===== SCAN DE DESINSTALAÇÃO =====
echo
echo "=== ANALISANDO POSSÍVEL DESINSTALAÇÃO DE HACK ==="
echo

for file in scan_temp/**/*.txt scan_temp/**/*.log; do
  [ -f "$file" ] || continue

  for key in "${uninstall_keywords[@]}"; do
    results=$(grep -in "$key" "$file")
    if [ -n "$results" ]; then
      echo "[!] POSSÍVEL RASTRO DE DESINSTALAÇÃO"
      echo "    Palavra: \"$key\""
      echo "    Arquivo: $file"
      echo "$results" | while read -r line; do
        echo "    Linha: $line"
      done
      score=$((score+2))
    fi
  done
done

# ===== RESULTADO FINAL =====
echo
echo "=== RESULTADO ==="

if [ "$score" -eq 0 ]; then
  echo "STATUS: LIMPO"
elif [ "$score" -le 3 ]; then
  echo "STATUS: SUSPEITO"
else
  echo "STATUS: XITADO"
fi

echo "Pontuação: $score"
0
